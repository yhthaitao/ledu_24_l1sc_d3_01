(()=>{var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),("undefined"==typeof window?e.g:window).aliLogMsg={b_init:!1,baseUrl:"",params:{},initBaseUrl(e,s,t){this.baseUrl=`https://${s}.${e}/logstores/${t}/track?APIVersion=0.6.0`},getURLparam(e){var s=location.href.split("?");if(!(s.length<2))for(var t=s[1].split("&"),a=0;a<t.length;a++)if(0===t[a].indexOf(e+"="))return t[a].substring(e.length+1);return null},push(e,s){this.params[e]=s},send(){let e=new XMLHttpRequest,s="";for(var t in this.params)s+=`&${t}=`+this.params[t];this.params={},s=this.baseUrl+s,console.log(s),e.open("GET",s),e.setRequestHeader("Content-Type","application/json;charset=utf-8"),e.timeout=1e4,e.onerror=function(e){console.error("fail to send log",e)},e.ontimeout=function(e){console.error("fail to send log",e)},e.send()},meta:[],seq:0,queue:[],reporting:!1,uuid:"",generateUUID(){var t,e;""==this.uuid&&(t=(new Date).getTime(),window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?s:3&s|8).toString(16)}),this.uuid=e)},setMeta(e,s){this.meta.push([e,s])},doLog(e,s){this.queueLog(e,s)},async queueLog(e,s){var t=this.getFormatedTimeString();this.queue.push([e,s,t]),this.reportIt()},async reportIt(){if(!this.reporting){for(this.reporting=!0;0<this.queue.length;){var[e,s,t]=this.queue.shift();await this.singleLog(e,s,t)}this.reporting=!1}},singleLog(e,s,t){for(const[e,s]of this.meta)this.push(e,s);var a=this.getURLparam("groupId")||123;return this.push("seq",""+ ++this.seq),this.push("t",t),this.push("level",e),this.push("groupId",a),this.push("msg",3e3<s.length?s.slice(0,3e3):s),this.send()},pad:(e,s)=>("0".repeat(s)+e).slice(-s),getFormatedTimeString(){var e=new Date;return e.getFullYear()+"-"+this.pad(e.getMonth()+1,2)+"-"+this.pad(e.getDate(),2)+"T"+this.pad(e.getHours(),2)+":"+this.pad(e.getMinutes(),2)+":"+this.pad(e.getSeconds(),2)+"."+this.pad(e.getMilliseconds(),3)},prefix:"",setRemoteLogInfo(e,s){this.setMeta("src",e+" - "+s)},log(e,...s){this.info(e,...s)},info(e,...s){this.logIt("info",e,...s)},warn(e,...s){this.logIt("warn",e,...s)},error(e,...s){this.logIt("error",e,...s)},log2(e,s,...t){this.logIt(e,s,...t)},logIt(e,s,...t){s=s+" "+this.stringifyMsg(...t),t=this.prefix?this.prefix+s:s,this.doLog(e,t)},stringifyMsg:(...e)=>e.map(e=>"string"==typeof e?e:JSON.stringify(e)).join(" "),consoleHandler(e,s,...t){switch(e){case"info":console.info(prefix+s,...t);break;case"warn":console.warn(prefix+s,...t);break;case"error":console.error(prefix+s,...t)}},init(e,s,t,a,i){this.b_init||(this.b_init=!0,this.initBaseUrl("cn-beijing.log.aliyuncs.com","ledu-saas-jiaohuyouxi","interaction-game"),this.seq=0,this.generateUUID(),this.setMeta("uuid",this.uuid+"-"+s),this.setMeta("coursewareId",t),this.setMeta("gameId",a),this.setMeta("env",i),this.setRemoteLogInfo(e,s))},engineLoadStart(){this.info("engineLoadStart","url: "+location.href)},engineLoadEnd(){this.info("engineLoadEnd")},resLoadStart(){this.info("resLoadStart")},resLoadEnd(){this.info("resLoadEnd")},subResLoadStart(){this.info("subResLoadStart")},subResLoadEnd(){this.info("subResLoadEnd")},gameMsg_gameStart(){this.info("gameMsg_gameStart")},iframeMsg_gameStart(){this.info("iframeMsg_gameStart")},iframeMsg_subGameStart(){this.info("iframeMsg_subGameStart")},gameLevelReport(e){this.info("gameLevelReport",e)},gameOverReport(e){this.info("gameOverReport",e)},gameStop(){this.info("gameStop")},gameFinish(){this.info("gameFinish")},URLError(e){this.error("URLError",e)},httpTimeOut(e){this.error("httpTimeOut",e)},httpError(e){this.error("httpError",e)},differntKey(e){this.error("differntKey",e)}},("undefined"==typeof window?e.g:window).iframeMsg={groupId:null,send_as_message(e){var s=this.groupId||this.getURLparam("groupId")||123;s&&window.parent!==window&&(e.groupId=s,window.parent.postMessage(e,"*"))},on_as_message(t,a){window.addEventListener("message",e=>{var s=e.data;if(s){"getTransferReport"==s.type&&(s.type="recv_sync_data");const e=s.type;e===a&&(t(s),"recv_switch_game"===e)&&s.data.params&&s.data.params.groupId&&(this.groupId=s.data.params.groupId)}})},getURLparam(e){var s=location.href.split("?");if(!(s.length<2))for(var t=s[1].split("&"),a=0;a<t.length;a++)if(0===t[a].indexOf(e+"="))return t[a].substring(e.length+1);return null},recv_sync_data(e){this.on_as_message(e,"recv_sync_data")},recv_store_data(e){this.on_as_message(e,"recv_store_data")},recv_msg_frequency(e){this.on_as_message(e,"recv_msg_frequency")},send_sync_data(e){this.send_as_message({type:"send_sync_data",data:e})},request_main_res_load_end(e){this.send_as_message({type:"request_main_res_load_end",data:e})},game_start(e){this.send_as_message({type:"game_start",data:e})},sub_game_start(e){this.send_as_message({type:"sub_game_start",data:e})},get_store_data(e){this.send_as_message({type:"get_store_data",data:e})},get_is_sync(e){var s=this.getURLparam("isSync");e("1"==s||"true"==s)},store_data(e){this.send_as_message({type:"store_data",data:e})},recv_json_data(e){this.on_as_message(e,"recv_json_data")},request_json_data(e){this.send_as_message({type:"request_json_data",data:e})},request_fps(e){this.send_as_message({type:"request_fps",data:e})},recv_sync_3s_data(e){this.on_as_message(e,"recv_sync_3s_data")},send_sync_3s_data(e){this.send_as_message({type:"send_sync_3s_data",data:e})},recv_show_gamePanel(e){this.on_as_message(e,"recv_show_gamePanel")},recv_hide_gamePanel(e){this.on_as_message(e,"recv_hide_gamePanel")},request_res_load_start(e){this.send_as_message({type:"request_res_load_start",data:e})},request_sub_res_load_start(e){this.send_as_message({type:"request_sub_res_load_start",data:e})},res_load_process(e){this.send_as_message({type:"res_load_process",data:e})},recv_sub_res_load_process(e){this.send_as_message({type:"recv_sub_res_load_process",data:e})},request_res_load_end(e){this.send_as_message({type:"request_res_load_end",data:e})},request_sub_res_load_end(e){this.send_as_message({type:"request_sub_res_load_end",data:e})},request_engine_load_start(e){this.send_as_message({type:"request_engine_load_start",data:e})},request_engine_load_end(e){this.send_as_message({type:"request_engine_load_end",data:e})},recv_keep_playing(e){this.on_as_message(e,"recv_keep_playing")},request_keep_playing(e){this.send_as_message({type:"request_keep_playing",data:e})},recv_cancel_keep_playing(e){this.on_as_message(e,"recv_cancel_keep_playing")},recv_restart(e){this.on_as_message(e,"recv_restart")},request_restart_over(e){this.send_as_message({type:"request_restart_over",data:e})},request_event_ready(e){this.send_as_message({type:"request_event_ready",data:e})},recv_is_master(e){this.on_as_message(e,"recv_is_master")},request_sync_init(e){this.send_as_message({type:"request_sync_init",data:e})},request_sub_sync_init(e){this.send_as_message({type:"request_sub_sync_init",data:e})},request_load_err(e){this.send_as_message({type:"request_load_err",data:e})},answer_sync_send(e){this.send_as_message({type:"answer_sync_send",data:{answer_data:e}})},game_over(e){this.send_as_message({type:"game_over",data:e})},request_level_info(e){this.send_as_message({type:"request_level_info",data:e})},game_statistic_data(e){this.send_as_message({type:"game_statistic_data",data:e})},request_webglcontextlost(){this.send_as_message({type:"request_webglcontextlost",data:null})},recv_switch_game(e){this.on_as_message(e,"recv_switch_game")},recv_preload_game(e){this.on_as_message(e,"recv_preload_game")},recv_pause_game(e){this.on_as_message(e,"recv_pause_game")}},("undefined"==typeof window?e.g:window).cosMsg={};{const s=navigator.userAgent,a=-1<s.indexOf("Android")||-1<s.indexOf("Adr"),i=!!s.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),t=(window.setupWebViewJavascriptBridge=a?e=>{window.WebViewJavascriptBridge?e(window.WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){e(window.WebViewJavascriptBridge)},!1)}:e=>{if(window.WebViewJavascriptBridge)return e(window.WebViewJavascriptBridge);if(window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var s=document.createElement("iframe");s.style.display="none",s.src="wvjbscheme://__BRIDGE_LOADED__",document.documentElement.appendChild(s),setTimeout(function(){document.documentElement.removeChild(s)},0)},console.log("isAndroid ",a),console.log("isIOS ",i),a&&window.setupWebViewJavascriptBridge(function(e){e.init(function(e,s){console.log(e),s("JS 返回给原生的消息内容")}),e.registerHandler("GameMsg2Web",(e,s)=>{console.log("GameMsg2Web app 返回消息 ",e),t(e),s&&s("")})}),i&&window.setupWebViewJavascriptBridge(e=>{e.registerHandler("GameMsg2Web",(e,s)=>{console.log("GameMsg2Web app 返回消息 ",e),t(e),s&&s("")})}),e=>{window.postMessage({type:"gameMsg",msg:e},"*")});("undefined"==typeof window?e.g:window).gameMsg={page_events:{},client_events:["disabled","init","stop","data_recovery","action_sync_receive","reload","threshhold","audio_control","speech_recognition_report","return_microphone_rights"],on_client_event(e,s){var t;e&&-1!=this.client_events.indexOf(e)?(Object.keys(this.page_events).length||window.addEventListener("message",e=>{e&&e.data&&"gameMsg"==e.data.type&&this.exec_handlers(this.page_events[e.data.msg.type],e.data.msg)},!1),(t=this.page_events)[e]?t[e].push(s):t[e]=[s]):console.warn("不存在的消息类型")},exec_handlers(e,s){if(e&&e.length)for(var t=0,a=e.length;t<a;t++)e[t](s.data)},off(){window.removeEventListener("message")},last:null,last_type:null,threshhold:100,send_to_client(e){var s,t=+new Date;this.last_type==e.type&&this.last&&t<this.last+this.threshhold||(this.last=t,this.last_type=e.type,t=window.self==window.parent,console.log("noParent ",t),t?(s=e,(a||i)&&window.setupWebViewJavascriptBridge(e=>{e.callHandler("GameMsg2App",s,e=>{console.log("GameMsg2App web 发送消息 ",e)})})):window.parent.postMessage({type:"gameMsg",msg:e},"*"))},engine_load_start(e,s){this.send_to_client({type:"engine_load_start",data:{type:e,engine_version:s}})},engine_load_complete(){this.send_to_client({type:"engine_load_complete"})},res_load_start(e,s){this.send_to_client({type:"res_load_start",data:{type:e,protocol_version:s}})},res_load_process(e){this.send_to_client({type:"res_load_process",data:e})},res_load_complete(){this.send_to_client({type:"res_load_complete"})},answer_sync_send(e){this.send_to_client({type:"answer_sync_send",data:{answer_data:e}})},game_start(){this.send_to_client({type:"game_start"})},game_over(e){this.send_to_client({type:"game_over",data:e})},finished(){this.send_to_client({type:"finished"})},speech_recognition_start(e){this.send_to_client({type:"speech_recognition_start",data:e})},speech_recognition_over(e){this.send_to_client({type:"speech_recognition_over",data:e})},get_microphone_rights(){this.send_to_client({type:"get_microphone_rights"})},game_statistic_data(e){this.send_to_client({type:"game_statistic_data",data:e})}}}})();